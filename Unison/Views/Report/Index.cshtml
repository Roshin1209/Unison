
@{
    ViewBag.Title = "Index";
}

<!-- Form Element area Start-->
<div class="form-element-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="form-element-list">
                    @*<div class="basic-tb-hd">
                            <h2>Input Text</h2>
                            <p>Text Inputs with different sizes by height and column.</p>
                        </div>*@
                    <div class="cmp-tb-hd bcs-hd">
                        <h2>Case Report</h2>
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    Hospital name
                                </div>
                                <div class="nk-int-st">
                                    <select class="form-control" id="ddlHospital">
                                        <option value="">Select</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    Assignee
                                </div>
                                <div class="nk-int-st">
                                    <select class="form-control" id="ddlassignee">
                                        <option value="">Select</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    Service Code
                                </div>
                                <div class="nk-int-st">
                                    <input type="text" class="form-control" placeholder="Service Code" id="txtAssetId">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    Manufacturer
                                </div>
                                <div class="nk-int-st">
                                    <select class="form-control" id="ddlManufaturer">
                                        <option value="">Select</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    Service provider
                                </div>
                                <div class="nk-int-st">
                                    <select class="form-control" id="ddlServiceProvider">
                                        <option value="">Select</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    Status
                                </div>
                                <div class="nk-int-st">
                                    <select class="form-control" id="ddlStatus">
                                        <option value="">Select</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                      
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    Asset Name
                                </div>
                                <div class="nk-int-st">
                                    <select class="form-control" id="ddlAssets">
                                        <option value="">Select</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    Problem Category
                                </div>
                                <div class="nk-int-st">
                                    <select class="form-control" id="ddlProblemCategory">
                                        <option value="">Select</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                   From Date
                                </div>
                                <div class="nk-int-st">
                                    <input type="date" class="form-control" placeholder="yyyy/mm/dd" id="dtFromDate">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <div class="form-group ic-cmp-int">
                                <div class="form-ic-cmp">
                                    To Date
                                </div>
                                <div class="nk-int-st">
                                    <input type="date" class="form-control" placeholder="yyyy/mm/dd" id="dtEndDate">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                            <button class="btn btn-primary notika-btn-primary" onclick="Load_Report();">Search</button>
                            <button class="btn notika-btn-bluegray btn-reco-mg btn-button-mg" onclick="fnReload()">Clear</button>
                        </div>

                    </div>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="data-table-list">
                    <div class="basic-tb-hd">
                        <h2>Case Report</h2>

                    </div>
                    <div class="table-responsive">
                        <table id="tblData" class="table table-striped"></table>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>
<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
<link href="~/Content/TEST/datatables.css" rel="stylesheet" />
<script src="~/Content/TEST/datatables.js"></script>

<script src="https://cdn.datatables.net/buttons/1.5.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.2/js/buttons.html5.min.js"></script>





<script type="text/javascript">
    //Global Variables
    //Global Variables
    $(document).ready(function () {
        Load_ServiceProvider();
        Load_Hospital();
        Load_Assignee();
        LoadManufaturer();
        Load_Status();
        Load_Problem_Category();
        Load_AssetMaster();
    });
    //Document Ready Closed
    function Load_Hospital() {
        $.ajax({
            url: '@Url.Action("LoadHospitalMaster", "Master")',
            //data:"Problem_Categroy="+Prob_Cat,
            type: "POST",
            success: function (resp) {
                if (resp != null) {
                    var str = "";

                    for (var l = 0; l < resp.length; l++) {
                        str += "<option value='" + resp[l].Hospital_Id + "'>" + resp[l].Hospital_Name + "</option>";
                    }
                    $('#ddlHospital').append(str);
                } else {
                    //ALERT("Error");
                }

            }
        });
    }
     function Load_ServiceProvider() {
        $.ajax({
            url: '@Url.Action("LoadServiceProviderMaster", "Master")',
            //data:"Problem_Categroy="+Prob_Cat,
            type: "POST",
            async:false,
            success: function (resp) {
                if (resp != null) {
                    var str = "";
                    for (var l = 0; l < resp.length; l++) {
                        str += "<option value='" + resp[l].ServiceProvider_Id + "'>" + resp[l].ServiceProvider_Name + "</option>";
                    }
                    $('#ddlServiceProvider').append(str);
                } else {
                    //ALERT("No Data");
                }

            }
        });
    }
    function LoadManufaturer() {
        $.ajax({
            url: '@Url.Action("LoadManufacturerMaster", "Master")',
            //data:"Problem_Categroy="+Prob_Cat,
            async:false,
            type: "POST",
            success: function (resp) {
                if (resp != null) {
                    var str = "";
                    for (var l = 0; l < resp.length; l++) {
                        str += "<option value='" + resp[l].Manufacturer_Id + "'>" + resp[l].Manufacturer_Name + "</option>";
                    }
                    $('#ddlManufaturer').append(str);
                } else {
                    ALERT("No Data");
                }

            }
        });
     }
    function Load_Assignee() {
        $.ajax({
            url: '@Url.Action("Load_Assignee_Master", "Master")',
            //data:"Problem_Categroy="+Prob_Cat,
            type: "POST",
            success: function (resp) {
                if (resp != null) {
                    var str = "";
                    for (var l = 0; l < resp.length; l++) {
                        str += "<option value='" + resp[l].Assignee_Id + "'>" + resp[l].Assignee_Name + "</option>";

                    }
                    $('#ddlassignee').append(str);

                } else {
                    ALERT("No Data");
                }

            }
        });
    }
    function Load_Report() {
        var Hospital_Name = $('#ddlHospital option:selected').text();
        var Assignee = $('#ddlassignee option:selected').text();
        var Manufacturer = $('#ddlManufaturer option:selected').text();
        var Asset_Id = $.trim($('#txtAssetId').val());
        var ServiceProvider = $('#ddlServiceProvider option:selected').text();


        var EndDate=$('#dtEndDate').val();
        var FromDate=$('#dtFromDate').val();
        var ProbCate = $('#ddlProblemCategory option:selected').text();
        var Status = $('#ddlStatus option:selected').text();
        var AssetName=$('#ddlAssets option:selected').text();
        

        if (Hospital_Name == "Select") {
            Hospital_Name = "";
        }
        if (Assignee == "Select") {
            Assignee = "";
        }
        if (Manufacturer == "Select") {
            Manufacturer = "";
        }
        if (ServiceProvider == "Select") {
            ServiceProvider = "";
        }
        if (ProbCate == "Select") {
            ProbCate = "";
        }
        if (Status == "Select") {
            Status = "";
        }
        if (AssetName == "Select") {
            AssetName = "";
        }
        $.ajax({
            url: '@Url.Action("CASE_Report", "Report")',
            data: "Hospital_Name=" + Hospital_Name + "&Assignee=" + Assignee + "&Manufacturer=" + Manufacturer + "&Asset_Id=" + Asset_Id + "&ServiceProvider=" + ServiceProvider
            + "&ProbCate=" + ProbCate + "&Status=" + Status + "&AssetName=" + AssetName + "&FromDate=" + FromDate + "&EndDate=" + EndDate,
            type: "POST",
            success: function (resp) {
                if (resp != null) {
                    var str = "";
                    str += "<thead>";
                    str += "<tr>";
                    //str += "<th>Mobile Number</th>";
                    //str += "<th>Requestor Name</th>";
                    //str += "<th>Case Id</th>";
                    //str += "<th>Assignee</th>";
                    //str += "<th>Hospital Name</th>";
                    //str += "<th>Asset Name - Asset Id</th>";
                    //str += "<th>ServiceProvider Name</th>";
                    //str += "<th>Manufacturer Name</th>";
                    //str += "<th>Priority</th>";
                    //str += "<th>Status</th>";
                    //str += "<th>Problem category</th>";
                    //str += "<th>RootCause Name</th>";
                    //str += "<th>Created by</th>";
                    //str += "<th>Created Date</th>";
                    //str += "<th>Closed Date</th>";
                    str += "<th>Created Date</th>";
                    str += "<th>Ticket Id</th>";
                    str += "<th>Asset Id</th>";
                    str += "<th>Hospital Name</th>";
                    str += "<th>Manufacture Name</th>";
                    str += "<th>Asset Name</th>";
                    str += "<th>Asset Description</th>";
                    str += "<th>Serial Number</th>";
                    str += "<th>Problem Description</th>";
                    str += "<th>Category Name</th>";
                    str += "<th>Service Provider Name Name</th>";
                    str += "<th>Assigneee</th>";
                    str += "<th>Assigneee Mobile No.</th>";
                    str += "<th>Due Date</th>";
                    str += "<th>Requestor Name</th>";
                    str += "<th>Requestor Mobile No.</th>";
                    str += "<th>Priority</th>";
                    str += "<th>Status</th>";
                    str += "<th>Solution</th>";
                    str += "<th>Root Cause Name</th>";
                    str += "<th>Root Cause Description</th>";
                    str += "<th>User Name</th>";
                    str += "<th>Comments</th>";
                    str += "<th>Closed Date</th>";
                    str += "</tr>";
                    str += "</thead>";
                    str += "<tbody>";

                    for (var l = 0; l < resp.length; l++) {
                        str += "<tr>";
                        str += "<td>" + resp[l].Created_Date + "</td>";
                        str += "<td>" + resp[l].Ticket_Id + "</td>";
                        str += "<td>" + resp[l].Assets_Id + "</td>";
                        str += "<td>" + resp[l].Hospital_Name + "</td>";
                        str += "<td>" + resp[l].Manufacturer_Name + "</td>";
                        str += "<td>" + resp[l].Asset_Name + "</td>";
                        str += "<td>" + resp[l].Asset_Description + "</td>";
                        str += "<td>" + resp[l].SerialNumber + "</td>";
                        str += "<td>" + resp[l].ProblemDescripition + "</td>";
                        str += "<td>" + resp[l].Category_Name + "</td>";
                        str += "<td>" + resp[l].ServiceProvider_Name + "</td>";
                        str += "<td>" + resp[l].Assignee_Name + "</td>";
                        str += "<td>" + resp[l].Contact_Number + "</td>";
                        str += "<td>" + resp[l].dtDueDate + "</td>";
                        str += "<td>" + resp[l].RequestorName + "</td>";
                        str += "<td>" + resp[l].RequestorMobileNo + "</td>";
                        str += "<td>" + resp[l].Priority + "</td>";
                        str += "<td>" + resp[l].Status_Name + "</td>";
                        str += "<td>" + resp[l].Solution + "</td>";
                        str += "<td>" + resp[l].RootCause_Name + "</td>";
                        str += "<td>" + resp[l].rootCDescripition + "</td>";
                        str += "<td>" + resp[l].Created_By + "</td>";
                        str += "<td>" + resp[l].Comments + "</td>";
                        str += "<td>" + resp[l].Closed_Date + "</td>";
                        //str += "<td>" + resp[l].Contact_Number + "</td>";
                        //str += "<td>" + resp[l].RequestorName + "</td>";
                        //str += "<td>" + resp[l].Id + "</td>";
                        //str += "<td>" + resp[l].Assignee_Name + "</td>";
                        //str += "<td>" + resp[l].Hospital_Name + "</td>";
                        //str += "<td>" + resp[l].Asset_Name + "-" + resp[l].Unison_ID + "</td>";
                        //str += "<td>" + resp[l].ServiceProvider_Name + "</td>";
                        //str += "<td>" + resp[l].Manufacturer_Name + "</td>";
                        //str += "<td>" + resp[l].Priority + "</td>";
                        //str += "<td>" + resp[l].Status_Name + "</td>";
                        //str += "<td>" + resp[l].Category_Name + "</td>";
                        //str += "<td>" + resp[l].RootCause_Name + "</td>";
                        //str += "<td>" + resp[l].User_Name + "</td>";
                        //str += "<td>" + resp[l].Created_Date + "</td>";
                        //str += "<td>" + resp[l].Closed_Date + "</td>";

                        //str += "<td><a href='#' onclick=fnEdit('" + resp[l].Id + "')>Edit</a></td>";
                        str += "</tr>";
                    }
                    str += "</tbody>";
                    $('#tblData').empty();
                    $('#tblData').append(str);
                    $('#tblData').DataTable().destroy();
                    // $('#tblData').DataTable();
                    $('#tblData').DataTable(
                        {
                            dom: 'Bfrtip',
                            buttons: [
                                {
                                    extend: 'copyHtml5',
                                    className: 'btn btn-primary notika-btn-primary waves-effect',
                                    exportOptions: {
                                        columns: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
                                    }
                                },
                                {
                                    extend: 'excelHtml5',
                                    className: 'btn btn-primary notika-btn-primary waves-effect',
                                    exportOptions: {
                                        columns: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
                                    }
                                }
                            ]
                        });

                } else {
                    //ALERT("Error");
                }
            }
        });
    }
    function fnReload() {
        $('#ddlHospital').val('-1');
        $('#ddlassignee').val('-1');
        $('#ddlManufaturer').val('-1');
        $('#txtAssetId').val('');
        $('#ddlServiceProvider').val('-1');
        $('#dtEndDate').val('');
        $('#dtFromDate').val('');
        $('#ddlProblemCategory').val('-1');
        $('#ddlStatus').val('-1');
        $('#ddlAssets').val('-1');
        //location.reload();
    }
    function Load_Status() {
        $.ajax({
            url: '@Url.Action("LoadstatusMaster", "Master")',
            //data:"Problem_Categroy="+Prob_Cat,
            type: "POST",
            success: function (resp) {
                if (resp != null) {
                    var str = "";

                    for (var l = 0; l < resp.length; l++) {
                        str += "<option value='" + resp[l].Id + "'>" + resp[l].Status_Name + "</option>";
                    }
                    $('#ddlStatus').append(str);
                } else {
                    //ALERT("Error");
                }

            }
        });
    }
    function Load_Problem_Category() {
        $.ajax({
            url: '@Url.Action("LoadProblemCategory","Master")',
            //data:"Problem_Categroy="+Prob_Cat,
            type: "POST",
            success: function (resp) {
                if (resp != null) {
                    var str = "";

                    for (var l = 0; l < resp.length; l++) {
                        str += "<option value='" + resp[l].Id + "'>" + resp[l].Category_Name + "</option>";
                    }
                    $('#ddlProblemCategory').append(str);
                } else {
                    //ALERT("Error");
                }

            }
        });
    }
    function Load_AssetMaster() {
        $.ajax({
            url: '@Url.Action("Load_Asset_Master", "Master")',
            //data:"Problem_Categroy="+Prob_Cat,
            type: "POST",
            success: function (resp) {
                if (resp != null) {
                    var str = "";
                    var unique = resp.filter(function (itm, i, resp) {
                        return i == resp.indexOf(itm);
                    });
                    for (var l = 0; l < unique.length; l++) {
                        str += "<option value='" + unique[l].Asset_Id + "'>" + unique[l].Asset_Name + "</option>";//+ " - " + resp[l].Unison_ID
                    }
                    $('#ddlAssets').append(str);


                } else {
                    ALERT("No Data");
                }

            }
        });
    }
</script>

